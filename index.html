<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeni Sekme</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: { 
                        'fade-in': 'fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-up': 'slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pop-in': 'popIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards'
                    },
                    keyframes: { 
                        fadeIn: { '0%': { opacity: '0', transform: 'scale(0.98)' }, '100%': { opacity: '1', transform: 'scale(1)' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        popIn: { '0%': { opacity: '0', transform: 'scale(0.9) translateY(10px)' }, '100%': { opacity: '1', transform: 'scale(1) translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            /* Varsayılan arka plan, JS ile ezilecek */
            background: linear-gradient(to bottom right, #1a1a1a, #000000);
            transition: background 0.5s ease;
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .glass-widget {
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .glass-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
        
        .todo-item.completed span { text-decoration: line-through; opacity: 0.5; }
        
        /* Renk Seçici Yuvarlağı */
        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s, border-color 0.2s;
        }
        .color-option:hover { transform: scale(1.1); }
        .color-option.active { border-color: white; transform: scale(1.1); }
    </style>
</head>
<body class="w-full flex flex-col items-center justify-center text-white overflow-hidden select-none relative font-sans">

    <!-- Üst Kontroller -->
    <div class="absolute top-0 left-0 w-full p-6 flex justify-between items-start z-20">
        <!-- Sol: Saat/Tarih Widget'ı -->
        <div class="flex flex-col opacity-80 hover:opacity-100 transition duration-300">
            <span id="miniDate" class="text-xs font-bold tracking-widest uppercase text-white/60">...</span>
            <div class="flex items-center gap-2">
                <i class="ph ph-map-pin text-lg"></i>
                <span class="text-sm font-medium">İstanbul</span>
            </div>
        </div>

        <!-- Sağ: Araçlar -->
        <div class="flex gap-3">
            <button onclick="toggleTodo()" class="p-3 rounded-full glass hover:bg-white/20 transition duration-300 group relative">
                <i class="ph ph-check-square text-xl"></i>
                <span id="todoCountBadge" class="absolute -top-1 -right-1 bg-blue-500 text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
            </button>
            <button onclick="toggleWidget()" class="p-3 rounded-full glass hover:bg-white/20 transition duration-300 group" id="settingsBtn">
                <i class="ph ph-sliders-horizontal text-xl group-hover:rotate-90 transition-transform duration-500"></i>
            </button>
        </div>
    </div>

    <!-- Ana İçerik -->
    <main class="z-10 w-full max-w-4xl px-6 flex flex-col items-center gap-12 animate-fade-in relative">
        
        <!-- Büyük Saat -->
        <div class="text-center group cursor-default select-none pt-10">
            <h1 id="clock" class="text-[6rem] md:text-[11rem] font-bold tracking-tighter leading-none drop-shadow-2xl bg-clip-text text-transparent bg-gradient-to-b from-white to-white/60">00:00</h1>
            <div class="text-center mt-2 animate-slide-up" style="animation-delay: 0.1s;">
                <h2 class="text-xl md:text-3xl font-light drop-shadow-md text-white/90">
                    <span id="greetingTime">Merhaba</span>, <span id="userNameDisplay" class="font-semibold text-white border-b border-transparent hover:border-white/50 transition-all cursor-pointer">Kullanıcı</span>.
                </h2>
            </div>
        </div>

        <!-- Arama Çubuğu -->
        <div class="w-full max-w-2xl relative group animate-slide-up" style="animation-delay: 0.2s;">
            <button onclick="cycleSearchEngine()" class="absolute left-2 top-1/2 -translate-y-1/2 p-2 rounded-xl hover:bg-white/10 transition flex items-center gap-2 text-gray-300 hover:text-white z-20">
                <i id="searchIcon" class="ph ph-google-logo text-xl"></i>
            </button>
            <input 
                type="text" 
                id="searchInput"
                placeholder="Google'da ara..." 
                class="w-full py-4 pl-14 pr-6 rounded-2xl glass-input text-white placeholder-gray-400 focus:outline-none transition-all duration-300 text-lg shadow-2xl backdrop-blur-md"
                autocomplete="off"
                autofocus
            >
        </div>

        <!-- Linkler -->
        <div id="linksContainer" class="grid grid-cols-4 md:grid-cols-6 gap-4 mt-4 w-full max-w-3xl animate-slide-up" style="animation-delay: 0.3s;">
            <!-- Linkler buraya gelecek -->
        </div>
    </main>

    <!-- ÖZELLEŞTİRME WIDGET'I (Floating Panel) -->
    <div id="settingsWidget" class="fixed top-24 right-6 w-80 glass-widget rounded-3xl p-6 z-50 hidden opacity-0 transform scale-95 transition-all duration-300 origin-top-right">
        <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
            <h3 class="text-sm font-bold uppercase tracking-wider text-white/80">Stüdyo</h3>
            <button onclick="toggleWidget()" class="hover:text-red-400 transition text-white/50"><i class="ph ph-x text-lg"></i></button>
        </div>

        <div class="space-y-6">
            <!-- İsim -->
            <div>
                <label class="text-[10px] uppercase tracking-widest text-gray-400 font-bold mb-2 block">Kullanıcı Adı</label>
                <input type="text" id="nameInput" class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-500 transition text-white" placeholder="İsminiz">
            </div>

            <!-- Renk Paleti -->
            <div>
                <label class="text-[10px] uppercase tracking-widest text-gray-400 font-bold mb-3 block">Tema Rengi</label>
                <div class="grid grid-cols-5 gap-3" id="colorPalette">
                    <!-- JS ile doldurulacak -->
                </div>
                <div class="mt-3 flex items-center gap-3 bg-white/5 p-2 rounded-lg border border-white/10">
                    <input type="color" id="customColorPicker" class="w-8 h-8 rounded cursor-pointer bg-transparent border-none" value="#000000" title="Özel Renk">
                    <span class="text-xs text-gray-400">Özel Renk Seç</span>
                </div>
            </div>

            <!-- Hızlı Ekle -->
            <div class="pt-4 border-t border-white/10">
                <label class="text-[10px] uppercase tracking-widest text-gray-400 font-bold mb-2 block">Kısayol Ekle</label>
                <div class="space-y-2">
                    <input type="text" id="newLinkTitle" class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs focus:outline-none" placeholder="Başlık (Örn: Haberler)">
                    <input type="text" id="newLinkUrl" class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs focus:outline-none" placeholder="URL (https://...)">
                    <button onclick="addNewLink()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg text-xs font-bold transition">Ekle</button>
                </div>
            </div>
            
            <div class="text-center pt-2">
                 <button onclick="resetApp()" class="text-[10px] text-red-400/60 hover:text-red-400 transition">Varsayılanlara Dön</button>
            </div>
        </div>
    </div>

    <!-- TODO Sidebar -->
    <div id="todoPanel" class="fixed top-0 right-0 h-full w-80 glass-widget z-50 transform translate-x-full transition-transform duration-300 shadow-2xl flex flex-col border-l border-white/10">
        <div class="p-6 border-b border-white/10 flex justify-between items-center bg-black/20">
            <h3 class="font-bold text-sm uppercase tracking-wider flex items-center gap-2">Görevler</h3>
            <button onclick="toggleTodo()" class="hover:text-red-400 transition text-white/50"><i class="ph ph-x text-lg"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-2" id="todoList"></div>
        <div class="p-4 bg-black/20">
            <div class="flex gap-2">
                <input type="text" id="newTodoInput" placeholder="Görev ekle..." class="flex-1 bg-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:bg-white/20 transition">
                <button onclick="addTodo()" class="bg-white/10 hover:bg-blue-600 text-white rounded-lg px-3 py-2 transition"><i class="ph ph-plus"></i></button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" onclick="closeAllPanels()" class="fixed inset-0 z-40 hidden bg-black/20 backdrop-blur-[1px]"></div>

    <script>
        // --- DATA & CONFIG ---
        const colorThemes = [
            { id: 'midnight', bg: 'linear-gradient(to bottom right, #0f172a, #000000)', preview: '#0f172a' },
            { id: 'sunset', bg: 'linear-gradient(to bottom right, #4c0519, #000000)', preview: '#4c0519' }, // Rose/Red
            { id: 'ocean', bg: 'linear-gradient(to bottom right, #0c4a6e, #020617)', preview: '#0c4a6e' }, // Sky/Blue
            { id: 'forest', bg: 'linear-gradient(to bottom right, #064e3b, #022c22)', preview: '#064e3b' }, // Green
            { id: 'purple', bg: 'linear-gradient(to bottom right, #3b0764, #000000)', preview: '#3b0764' }, // Purple
        ];

        const defaultLinks = [
            { title: 'Youtube', url: 'https://youtube.com', icon: 'ph-youtube-logo' },
            { title: 'GitHub', url: 'https://github.com', icon: 'ph-github-logo' },
            { title: 'Twitter', url: 'https://twitter.com', icon: 'ph-x-logo' },
            { title: 'Reddit', url: 'https://reddit.com', icon: 'ph-reddit-logo' },
        ];

        const searchEngines = [
            { name: 'Google', url: 'https://www.google.com/search?q=', icon: 'ph-google-logo', placeholder: "Google..." },
            { name: 'YouTube', url: 'https://www.youtube.com/results?search_query=', icon: 'ph-youtube-logo', placeholder: "YouTube..." },
            { name: 'Bing', url: 'https://www.bing.com/search?q=', icon: 'ph-microsoft-logo', placeholder: "Bing..." }
        ];

        // State Init
        let state = JSON.parse(localStorage.getItem('widgetHomeState')) || {
            name: 'Kaptan',
            links: defaultLinks,
            themeMode: 'preset', // 'preset' or 'custom'
            themeValue: 'midnight', // id or hex code
            engineIndex: 0,
            todos: []
        };

        // --- DOM REFERENCES ---
        const els = {
            clock: document.getElementById('clock'),
            miniDate: document.getElementById('miniDate'),
            greeting: document.getElementById('greetingTime'),
            nameDisplay: document.getElementById('userNameDisplay'),
            nameInput: document.getElementById('nameInput'),
            searchInput: document.getElementById('searchInput'),
            searchIcon: document.getElementById('searchIcon'),
            linksContainer: document.getElementById('linksContainer'),
            widget: document.getElementById('settingsWidget'),
            todoPanel: document.getElementById('todoPanel'),
            todoList: document.getElementById('todoList'),
            todoBadge: document.getElementById('todoCountBadge'),
            overlay: document.getElementById('overlay'),
            colorPalette: document.getElementById('colorPalette'),
            colorPicker: document.getElementById('customColorPicker')
        };

        // --- CORE FUNCTIONS ---

        function saveState() {
            localStorage.setItem('widgetHomeState', JSON.stringify(state));
        }

        // Clock Logic
        function updateTime() {
            const now = new Date();
            els.clock.textContent = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            els.miniDate.textContent = now.toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'long' });
            
            const h = now.getHours();
            els.greeting.textContent = h < 6 ? 'İyi Geceler' : h < 12 ? 'Günaydın' : h < 18 ? 'Tünaydın' : 'İyi Akşamlar';
        }

        // Theme Logic
        function applyTheme() {
            let bgStyle = '';
            
            // UI Update for Palette
            els.colorPalette.innerHTML = '';
            colorThemes.forEach(theme => {
                const isActive = state.themeMode === 'preset' && state.themeValue === theme.id;
                const circle = document.createElement('div');
                circle.className = `color-option ${isActive ? 'active' : ''}`;
                circle.style.backgroundColor = theme.preview;
                circle.onclick = () => setTheme('preset', theme.id);
                els.colorPalette.appendChild(circle);
                
                if (isActive) bgStyle = theme.bg;
            });

            if (state.themeMode === 'custom') {
                bgStyle = state.themeValue; // Expecting Hex or solid color
                els.colorPicker.value = state.themeValue;
            } else if (!bgStyle) {
                // Fallback to default if preset not found
                bgStyle = colorThemes[0].bg; 
            }

            document.body.style.background = bgStyle;
        }

        function setTheme(mode, value) {
            state.themeMode = mode;
            state.themeValue = value;
            saveState();
            applyTheme();
        }

        els.colorPicker.addEventListener('input', (e) => {
            document.body.style.background = e.target.value; // Realtime preview
        });

        els.colorPicker.addEventListener('change', (e) => {
            setTheme('custom', e.target.value);
        });


        // Widget & Panel UI Logic
        function toggleWidget() {
            const isHidden = els.widget.classList.contains('hidden');
            if (isHidden) {
                closeTodo(); // Close other panel if open
                els.widget.classList.remove('hidden');
                setTimeout(() => {
                    els.widget.classList.remove('opacity-0', 'scale-95');
                }, 10);
                els.overlay.classList.remove('hidden');
                els.nameInput.value = state.name;
                applyTheme(); // Refresh palette UI
            } else {
                closeWidget();
            }
        }

        function closeWidget() {
            els.widget.classList.add('opacity-0', 'scale-95');
            setTimeout(() => els.widget.classList.add('hidden'), 300);
            checkOverlay();
        }

        function toggleTodo() {
            const isClosed = els.todoPanel.classList.contains('translate-x-full');
            if (isClosed) {
                closeWidget(); // Close other panel
                els.todoPanel.classList.remove('translate-x-full');
                els.overlay.classList.remove('hidden');
                renderTodos();
            } else {
                closeTodo();
            }
        }

        function closeTodo() {
            els.todoPanel.classList.add('translate-x-full');
            checkOverlay();
        }

        function checkOverlay() {
            // Only hide overlay if both panels are closed
            const widgetHidden = els.widget.classList.contains('hidden') || els.widget.classList.contains('opacity-0');
            const todoHidden = els.todoPanel.classList.contains('translate-x-full');
            
            if (widgetHidden && todoHidden) {
                els.overlay.classList.add('hidden');
            }
        }

        function closeAllPanels() {
            closeWidget();
            closeTodo();
        }

        // Name Logic
        els.nameInput.addEventListener('input', (e) => {
            state.name = e.target.value || 'Kullanıcı';
            els.nameDisplay.textContent = state.name;
            saveState();
        });

        // Search Logic
        function updateSearchUI() {
            const engine = searchEngines[state.engineIndex];
            els.searchIcon.className = `ph ${engine.icon} text-xl`;
            els.searchInput.placeholder = engine.placeholder;
        }

        function cycleSearchEngine() {
            state.engineIndex = (state.engineIndex + 1) % searchEngines.length;
            saveState();
            updateSearchUI();
        }

        els.searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && els.searchInput.value.trim()) {
                const engine = searchEngines[state.engineIndex];
                window.location.href = `${engine.url}${encodeURIComponent(els.searchInput.value.trim())}`;
            }
        });

        // Todo Logic
        function renderTodos() {
            els.todoList.innerHTML = '';
            const pending = state.todos.filter(t => !t.completed).length;
            els.todoBadge.textContent = pending;
            els.todoBadge.classList.toggle('hidden', pending === 0);

            if (state.todos.length === 0) {
                els.todoList.innerHTML = '<div class="text-center text-white/30 mt-10 text-xs">Görev yok.</div>';
                return;
            }

            state.todos.forEach((todo, idx) => {
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 todo-item ${todo.completed ? 'completed' : ''}`;
                div.innerHTML = `
                    <div class="flex items-center gap-3 flex-1 cursor-pointer" onclick="toggleTodoStatus(${idx})">
                        <div class="w-4 h-4 rounded border border-white/30 flex items-center justify-center ${todo.completed ? 'bg-green-500 border-green-500' : ''}">
                            $
